{"ast":null,"code":"// ModifyTenant.jsx import React, { useState } from \"react\"; const ModifyTenant = ({ sessionUser }) => { const [tenancyId, setTenancyId] = useState(\"\"); const [tenant, setTenant] = useState(null); const [formData, setFormData] = useState({}); const [previews, setPreviews] = useState({}); const [loading, setLoading] = useState(false); const photoFields = [ \"PassportCopyPath\", \"EIDCopyPath\", \"ResidenceVisaCopyPath\", \"BankStatementCopyPath\", \"DepositChequeCopyPath\", \"SecurityChequeCopyPath\", \"EjariMunicipalRegistrationCopyPath\", ]; // ------------------- Search Tenant ------------------- const handleSearch = async (e, idParam) => { e?.preventDefault(); const id = idParam || tenancyId; if (!id) return alert(\"Please enter a tenancy ID\"); try { setLoading(true); const res = await fetch(\"http://localhost:5000/modify_tenant/search\", { method: \"POST\", headers: { \"Content-Type\": \"application/json\" }, credentials: \"include\", body: JSON.stringify({ tenancyContractNumber: id }), }); const data = await res.json(); if (res.ok && data.success) { setTenant(data.tenant); // Populate non-file fields const initial = {}; Object.keys(data.tenant).forEach((k) => { if (!photoFields.includes(k)) initial[k] = data.tenant[k]; }); // Format date fields [ \"TenantDOB\", \"TenantPassportExpiryDate\", \"TenantEIDExpiryDate\", \"LeaseStartDate\", \"LeaseEndDate\", \"MoveInDate\", \"MoveOutDate\", \"CreationDate\", ].forEach((d) => { if (data.tenant[d] && typeof data.tenant[d] === \"string\") initial[d] = data.tenant[d].slice(0, 10); }); setFormData(initial); // Set image previews const p = {}; photoFields.forEach((f) => { if (data.tenant[f]) { const img = data.tenant[f]; p[f] = img.startsWith(\"data:\") ? img : data:image/jpeg;base64,${img}; } else p[f] = null; }); setPreviews(p); } else { alert(data.message || \"Tenant not found\"); setTenant(null); setFormData({}); setPreviews({}); } } catch (err) { console.error(err); alert(\"Error fetching tenant\"); } finally { setLoading(false); } }; // ------------------- Input Change ------------------- const handleChange = (e) => { const { name, value } = e.target; setFormData((prev) => ({ ...prev, [name]: value })); }; // ------------------- File Change ------------------- const handleFileChange = (e, key) => { const file = e.target.files[0]; if (!file) return; setFormData((prev) => ({ ...prev, [key]: file })); if (file.type.startsWith(\"image/\")) { const reader = new FileReader(); reader.onload = (ev) => setPreviews((prev) => ({ ...prev, [key]: ev.target.result })); reader.readAsDataURL(file); } else setPreviews((prev) => ({ ...prev, [key]: null })); }; // ------------------- Update Tenant ------------------- const handleUpdate = async (e) => { e.preventDefault(); if (!tenant) return alert(\"Please search a tenant first\"); const data = new FormData(); data.append( \"tenancy_contract_number\", tenant.TenancyContractNumber || tenancyId ); const fieldMap = { tenant_name: \"tenant_name\", tenant_dob: \"tenant_dob\", tenant_nationality: \"tenant_nationality\", tenant_passport: \"tenant_passport\", tenant_eid: \"tenant_eid\", passport_expiry: \"passport_expiry\", eid_expiry: \"eid_expiry\", tenant_employer: \"tenant_employer\", tenant_mobile: \"tenant_mobile\", tenant_email: \"tenant_email\", lease_start: \"lease_start\", lease_end: \"lease_end\", move_in: \"move_in\", move_out: \"move_out\", rent_amount: \"rent_amount\", deposit_amount: \"deposit_amount\", number_of_payments: \"number_of_payments\", created_by: \"created_by\", creation_date: \"creation_date\", }; Object.keys(fieldMap).forEach((key) => { const val = formData[key]; if (val instanceof File) data.append(fieldMap[key], val, val.name); else if (val != null) data.append(fieldMap[key], val); }); // Append files photoFields.forEach((field) => { const file = formData[field]; if (file instanceof File) data.append(field, file, file.name); }); // Defaults if (!formData.created_by) data.append(\"created_by\", sessionUser || \"admin\"); if (!formData.creation_date) data.append(\"creation_date\", new Date().toISOString().slice(0, 10)); try { setLoading(true); const res = await fetch(\"http://localhost:5000/modify_tenant/update\", { method: \"POST\", credentials: \"include\", body: data, }); const result = await res.json(); if (res.ok && result.success) { alert(✅ ${result.message}); // ✅ Re-fetch with correct ID to show both updated + old details await handleSearch( { preventDefault: () => {} }, tenant.TenancyContractNumber || tenancyId ); } else alert(❌ ${result.message || \"Failed to update tenant\"}); } catch (err) { console.error(err); alert(\"❌ Error updating tenant\"); } finally { setLoading(false); } }; const labelize = (s) => s .replace(/([A-Z])/g, \" $1\") .replace(/_/g, \" \") .replace(/\\b\\w/g, (ch) => ch.toUpperCase()) .trim(); const rows = [ [\"tenant_name\", \"tenant_dob\", \"tenant_nationality\", \"tenant_passport\"], [\"tenant_eid\", \"passport_expiry\", \"eid_expiry\", \"tenant_employer\", \"tenant_mobile\"], [\"tenant_email\", \"lease_start\", \"lease_end\", \"move_in\", \"move_out\"], [\"rent_amount\", \"deposit_amount\", \"number_of_payments\", \"rent_received\", \"rent_outstanding\"], [\"created_by\", \"creation_date\"], ]; const getValue = (key) => { if (formData[key] !== undefined) return formData[key]; if (!tenant) return \"\"; const map = { tenant_name: \"TenantName\", tenant_dob: \"TenantDOB\", tenant_nationality: \"TenantNationality\", tenant_passport: \"TenantPassportNumber\", tenant_eid: \"TenantEmiratesID\", passport_expiry: \"TenantPassportExpiryDate\", eid_expiry: \"TenantEIDExpiryDate\", tenant_employer: \"TenantEmployer\", tenant_mobile: \"TenantMobileNumber\", tenant_email: \"TenantEmailID\", lease_start: \"LeaseStartDate\", lease_end: \"LeaseEndDate\", move_in: \"MoveInDate\", move_out: \"MoveOutDate\", rent_amount: \"RentAmount\", deposit_amount: \"DepositAmountReceived\", number_of_payments: \"NumberOfPayments\", rent_received: \"RentAmountReceived\", rent_outstanding: \"RentAmountOutstanding\", created_by: \"CreatedBy\", creation_date: \"CreationDate\", }; const val = tenant[map[key] || key]; if ( !val && (key === \"created_by\" || key === \"creation_date\") && sessionUser ) return key === \"created_by\" ? sessionUser : new Date().toISOString().slice(0, 10); return val ?? \"\"; }; return ( <div style={{ fontFamily: \"Arial, sans-serif\", padding: 20 }}> <h2 style={{ textAlign: \"center\", background: \"#2f3640\", color: \"white\", padding: 15, margin: 0, }} > Modify Tenant </h2> {/* Search */} <form onSubmit={handleSearch} style={{ textAlign: \"center\", margin: \"20px 0\" }} > <label style={{ fontWeight: \"bold\", marginRight: 8 }}> Enter Tenant ID: </label> <input type=\"text\" value={tenancyId} onChange={(e) => setTenancyId(e.target.value)} placeholder=\"Ex: 1\" required style={{ width: 150, padding: 6, borderRadius: 5, border: \"1px solid #aaa\", }} /> <button type=\"submit\" style={{ marginLeft: 8, padding: \"6px 12px\", background: \"#273c75\", color: \"white\", border: \"none\", borderRadius: 5, cursor: \"pointer\", width: 200, }} > {loading ? \"Searching...\" : \"Search\"} </button> </form> {tenant && ( <form onSubmit={handleUpdate} encType=\"multipart/form-data\" style={{ maxWidth: 1500, margin: \"0 auto\", background: \"white\", padding: 20, borderRadius: 10, boxShadow: \"0 0 10px #ccc\", }} > {rows.map((cols, i) => ( <div key={i} style={{ display: \"grid\", gridTemplateColumns: repeat(${cols.length}, 1fr), gap: 15, marginBottom: 15, }} > {cols.map((field) => { const isDate = [ \"tenant_dob\", \"passport_expiry\", \"eid_expiry\", \"lease_start\", \"lease_end\", \"move_in\", \"move_out\", \"creation_date\", ].includes(field); const readOnly = [ \"tenancy_contract_number\", \"rent_received\", \"rent_outstanding\", ].includes(field); const value = getValue(field); return ( <div key={field}> <label style={{ fontWeight: \"bold\", display: \"block\", marginBottom: 6, }} > {labelize(field)} </label> {isDate ? ( <input type=\"date\" name={field} value={value || \"\"} onChange={handleChange} style={{ width: \"100%\", padding: 7, borderRadius: 6, border: \"1px solid #ccc\", }} /> ) : ( <input type=\"text\" name={field} value={value || \"\"} onChange={handleChange} readOnly={readOnly} style={{ width: \"100%\", padding: 7, borderRadius: 6, border: \"1px solid #ccc\", background: readOnly ? \"#f3f3f3\" : \"white\", }} /> )} </div> ); })} </div> ))} {/* Photos */} <div style={{ display: \"grid\", gridTemplateColumns: \"repeat(7,1fr)\", gap: 10, marginTop: 20, textAlign: \"center\", }} > {photoFields.map((field) => ( <div key={field}> <label style={{ fontWeight: \"bold\", display: \"block\", marginBottom: 6 }} > {field} </label> {previews[field] ? ( <img src={previews[field]} alt={field} style={{ width: 60, height: 60, objectFit: \"cover\", borderRadius: 4, border: \"1px solid #ccc\", display: \"block\", margin: \"0 auto 8px\", }} /> ) : ( <p style={{ margin: \"6px 0\" }}>N/A</p> )} <input type=\"file\" name={field} onChange={(e) => handleFileChange(e, field)} /> </div> ))} </div> <div style={{ textAlign: \"center\", marginTop: \"30px\" }}> <a href=\"/index\" style={{ ...styles.button, backgroundColor: \"#492bc0ff\", marginRight: \"20px\", textDecoration: \"none\", display: \"inline-block\", }} > ← Go Back Home </a> <button type=\"submit\" style={styles.deleteButton}> Modify Tenant </button> </div> </form> )} </div> ); }; const styles = { button: { width: 200, padding: \"10px 20px\", backgroundColor: \"#0097e6\", color: \"white\", border: \"none\", borderRadius: \"6px\", cursor: \"pointer\", fontSize: \"16px\", }, deleteButton: { width: 200, padding: \"10px 20px\", backgroundColor: \"#c0392b\", color: \"white\", border: \"none\", borderRadius: \"6px\", cursor: \"pointer\", fontSize: \"16px\", }, }; export default ModifyTenant;","map":{"version":3,"names":[],"sources":["C:/Users/ashu2/OneDrive/Desktop/React/PMA/frontend/src/pages/Tenants/ModifyTenant.jsx"],"sourcesContent":["// ModifyTenant.jsx import React, { useState } from \"react\"; const ModifyTenant = ({ sessionUser }) => { const [tenancyId, setTenancyId] = useState(\"\"); const [tenant, setTenant] = useState(null); const [formData, setFormData] = useState({}); const [previews, setPreviews] = useState({}); const [loading, setLoading] = useState(false); const photoFields = [ \"PassportCopyPath\", \"EIDCopyPath\", \"ResidenceVisaCopyPath\", \"BankStatementCopyPath\", \"DepositChequeCopyPath\", \"SecurityChequeCopyPath\", \"EjariMunicipalRegistrationCopyPath\", ]; // ------------------- Search Tenant ------------------- const handleSearch = async (e, idParam) => { e?.preventDefault(); const id = idParam || tenancyId; if (!id) return alert(\"Please enter a tenancy ID\"); try { setLoading(true); const res = await fetch(\"http://localhost:5000/modify_tenant/search\", { method: \"POST\", headers: { \"Content-Type\": \"application/json\" }, credentials: \"include\", body: JSON.stringify({ tenancyContractNumber: id }), }); const data = await res.json(); if (res.ok && data.success) { setTenant(data.tenant); // Populate non-file fields const initial = {}; Object.keys(data.tenant).forEach((k) => { if (!photoFields.includes(k)) initial[k] = data.tenant[k]; }); // Format date fields [ \"TenantDOB\", \"TenantPassportExpiryDate\", \"TenantEIDExpiryDate\", \"LeaseStartDate\", \"LeaseEndDate\", \"MoveInDate\", \"MoveOutDate\", \"CreationDate\", ].forEach((d) => { if (data.tenant[d] && typeof data.tenant[d] === \"string\") initial[d] = data.tenant[d].slice(0, 10); }); setFormData(initial); // Set image previews const p = {}; photoFields.forEach((f) => { if (data.tenant[f]) { const img = data.tenant[f]; p[f] = img.startsWith(\"data:\") ? img : data:image/jpeg;base64,${img}; } else p[f] = null; }); setPreviews(p); } else { alert(data.message || \"Tenant not found\"); setTenant(null); setFormData({}); setPreviews({}); } } catch (err) { console.error(err); alert(\"Error fetching tenant\"); } finally { setLoading(false); } }; // ------------------- Input Change ------------------- const handleChange = (e) => { const { name, value } = e.target; setFormData((prev) => ({ ...prev, [name]: value })); }; // ------------------- File Change ------------------- const handleFileChange = (e, key) => { const file = e.target.files[0]; if (!file) return; setFormData((prev) => ({ ...prev, [key]: file })); if (file.type.startsWith(\"image/\")) { const reader = new FileReader(); reader.onload = (ev) => setPreviews((prev) => ({ ...prev, [key]: ev.target.result })); reader.readAsDataURL(file); } else setPreviews((prev) => ({ ...prev, [key]: null })); }; // ------------------- Update Tenant ------------------- const handleUpdate = async (e) => { e.preventDefault(); if (!tenant) return alert(\"Please search a tenant first\"); const data = new FormData(); data.append( \"tenancy_contract_number\", tenant.TenancyContractNumber || tenancyId ); const fieldMap = { tenant_name: \"tenant_name\", tenant_dob: \"tenant_dob\", tenant_nationality: \"tenant_nationality\", tenant_passport: \"tenant_passport\", tenant_eid: \"tenant_eid\", passport_expiry: \"passport_expiry\", eid_expiry: \"eid_expiry\", tenant_employer: \"tenant_employer\", tenant_mobile: \"tenant_mobile\", tenant_email: \"tenant_email\", lease_start: \"lease_start\", lease_end: \"lease_end\", move_in: \"move_in\", move_out: \"move_out\", rent_amount: \"rent_amount\", deposit_amount: \"deposit_amount\", number_of_payments: \"number_of_payments\", created_by: \"created_by\", creation_date: \"creation_date\", }; Object.keys(fieldMap).forEach((key) => { const val = formData[key]; if (val instanceof File) data.append(fieldMap[key], val, val.name); else if (val != null) data.append(fieldMap[key], val); }); // Append files photoFields.forEach((field) => { const file = formData[field]; if (file instanceof File) data.append(field, file, file.name); }); // Defaults if (!formData.created_by) data.append(\"created_by\", sessionUser || \"admin\"); if (!formData.creation_date) data.append(\"creation_date\", new Date().toISOString().slice(0, 10)); try { setLoading(true); const res = await fetch(\"http://localhost:5000/modify_tenant/update\", { method: \"POST\", credentials: \"include\", body: data, }); const result = await res.json(); if (res.ok && result.success) { alert(✅ ${result.message}); // ✅ Re-fetch with correct ID to show both updated + old details await handleSearch( { preventDefault: () => {} }, tenant.TenancyContractNumber || tenancyId ); } else alert(❌ ${result.message || \"Failed to update tenant\"}); } catch (err) { console.error(err); alert(\"❌ Error updating tenant\"); } finally { setLoading(false); } }; const labelize = (s) => s .replace(/([A-Z])/g, \" $1\") .replace(/_/g, \" \") .replace(/\\b\\w/g, (ch) => ch.toUpperCase()) .trim(); const rows = [ [\"tenant_name\", \"tenant_dob\", \"tenant_nationality\", \"tenant_passport\"], [\"tenant_eid\", \"passport_expiry\", \"eid_expiry\", \"tenant_employer\", \"tenant_mobile\"], [\"tenant_email\", \"lease_start\", \"lease_end\", \"move_in\", \"move_out\"], [\"rent_amount\", \"deposit_amount\", \"number_of_payments\", \"rent_received\", \"rent_outstanding\"], [\"created_by\", \"creation_date\"], ]; const getValue = (key) => { if (formData[key] !== undefined) return formData[key]; if (!tenant) return \"\"; const map = { tenant_name: \"TenantName\", tenant_dob: \"TenantDOB\", tenant_nationality: \"TenantNationality\", tenant_passport: \"TenantPassportNumber\", tenant_eid: \"TenantEmiratesID\", passport_expiry: \"TenantPassportExpiryDate\", eid_expiry: \"TenantEIDExpiryDate\", tenant_employer: \"TenantEmployer\", tenant_mobile: \"TenantMobileNumber\", tenant_email: \"TenantEmailID\", lease_start: \"LeaseStartDate\", lease_end: \"LeaseEndDate\", move_in: \"MoveInDate\", move_out: \"MoveOutDate\", rent_amount: \"RentAmount\", deposit_amount: \"DepositAmountReceived\", number_of_payments: \"NumberOfPayments\", rent_received: \"RentAmountReceived\", rent_outstanding: \"RentAmountOutstanding\", created_by: \"CreatedBy\", creation_date: \"CreationDate\", }; const val = tenant[map[key] || key]; if ( !val && (key === \"created_by\" || key === \"creation_date\") && sessionUser ) return key === \"created_by\" ? sessionUser : new Date().toISOString().slice(0, 10); return val ?? \"\"; }; return ( <div style={{ fontFamily: \"Arial, sans-serif\", padding: 20 }}> <h2 style={{ textAlign: \"center\", background: \"#2f3640\", color: \"white\", padding: 15, margin: 0, }} > Modify Tenant </h2> {/* Search */} <form onSubmit={handleSearch} style={{ textAlign: \"center\", margin: \"20px 0\" }} > <label style={{ fontWeight: \"bold\", marginRight: 8 }}> Enter Tenant ID: </label> <input type=\"text\" value={tenancyId} onChange={(e) => setTenancyId(e.target.value)} placeholder=\"Ex: 1\" required style={{ width: 150, padding: 6, borderRadius: 5, border: \"1px solid #aaa\", }} /> <button type=\"submit\" style={{ marginLeft: 8, padding: \"6px 12px\", background: \"#273c75\", color: \"white\", border: \"none\", borderRadius: 5, cursor: \"pointer\", width: 200, }} > {loading ? \"Searching...\" : \"Search\"} </button> </form> {tenant && ( <form onSubmit={handleUpdate} encType=\"multipart/form-data\" style={{ maxWidth: 1500, margin: \"0 auto\", background: \"white\", padding: 20, borderRadius: 10, boxShadow: \"0 0 10px #ccc\", }} > {rows.map((cols, i) => ( <div key={i} style={{ display: \"grid\", gridTemplateColumns: repeat(${cols.length}, 1fr), gap: 15, marginBottom: 15, }} > {cols.map((field) => { const isDate = [ \"tenant_dob\", \"passport_expiry\", \"eid_expiry\", \"lease_start\", \"lease_end\", \"move_in\", \"move_out\", \"creation_date\", ].includes(field); const readOnly = [ \"tenancy_contract_number\", \"rent_received\", \"rent_outstanding\", ].includes(field); const value = getValue(field); return ( <div key={field}> <label style={{ fontWeight: \"bold\", display: \"block\", marginBottom: 6, }} > {labelize(field)} </label> {isDate ? ( <input type=\"date\" name={field} value={value || \"\"} onChange={handleChange} style={{ width: \"100%\", padding: 7, borderRadius: 6, border: \"1px solid #ccc\", }} /> ) : ( <input type=\"text\" name={field} value={value || \"\"} onChange={handleChange} readOnly={readOnly} style={{ width: \"100%\", padding: 7, borderRadius: 6, border: \"1px solid #ccc\", background: readOnly ? \"#f3f3f3\" : \"white\", }} /> )} </div> ); })} </div> ))} {/* Photos */} <div style={{ display: \"grid\", gridTemplateColumns: \"repeat(7,1fr)\", gap: 10, marginTop: 20, textAlign: \"center\", }} > {photoFields.map((field) => ( <div key={field}> <label style={{ fontWeight: \"bold\", display: \"block\", marginBottom: 6 }} > {field} </label> {previews[field] ? ( <img src={previews[field]} alt={field} style={{ width: 60, height: 60, objectFit: \"cover\", borderRadius: 4, border: \"1px solid #ccc\", display: \"block\", margin: \"0 auto 8px\", }} /> ) : ( <p style={{ margin: \"6px 0\" }}>N/A</p> )} <input type=\"file\" name={field} onChange={(e) => handleFileChange(e, field)} /> </div> ))} </div> <div style={{ textAlign: \"center\", marginTop: \"30px\" }}> <a href=\"/index\" style={{ ...styles.button, backgroundColor: \"#492bc0ff\", marginRight: \"20px\", textDecoration: \"none\", display: \"inline-block\", }} > ← Go Back Home </a> <button type=\"submit\" style={styles.deleteButton}> Modify Tenant </button> </div> </form> )} </div> ); }; const styles = { button: { width: 200, padding: \"10px 20px\", backgroundColor: \"#0097e6\", color: \"white\", border: \"none\", borderRadius: \"6px\", cursor: \"pointer\", fontSize: \"16px\", }, deleteButton: { width: 200, padding: \"10px 20px\", backgroundColor: \"#c0392b\", color: \"white\", border: \"none\", borderRadius: \"6px\", cursor: \"pointer\", fontSize: \"16px\", }, }; export default ModifyTenant;"],"mappings":"AAAA","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}